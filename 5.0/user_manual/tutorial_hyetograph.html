
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8">
    
    <title>Creating an interactive Hyetograph with Chaco and Traits &mdash; chaco 5.0.0 documentation</title>
    
    <link rel="stylesheet" type="text/css" href="../_static/css/spc-bootstrap.css">
    <link rel="stylesheet" type="text/css" href="../_static/css/spc-extend.css">
    <link rel="stylesheet" href="../_static/enthought.css" type="text/css" >
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" >
    <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" >
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '5.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        LINK_SUFFIX: '',
        SOURCELINK_SUFFIX: '.txt',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/js/copybutton.js"></script>
    <script type="text/javascript" src="../_static/js/wrap_on_dot.js"></script>
    <link rel="shortcut icon" href="../_static/img/favicon.ico">
    <link rel="search" title="Search" href="../search.html" >
    <link rel="top" title="chaco 5.0.0 documentation" href="../index.html" > 
  </head>
  <body>
  <div class="container">
    <div class="header">
    </div>
  </div>

    <div class="container">
      <div class="main">
        
	<div class="row-fluid">
	  <div class="span12">
	    <div class="spc-navbar">
              
    <ul class="nav nav-pills pull-left">
	
        <li class="active"><a href="../index.html">chaco 5.0.0 documentation</a></li>
	
  
    <li><a href="#">Creating an interactive Hyetograph with Chaco and Traits</a></li>
  

    </ul>
              
              
    <ul class="nav nav-pills pull-right">
      <li class="active">
        <a href="../py-modindex.html" title="Python Module Index"
           >modules</a>
      </li>
    </ul>
              
	    </div>
	  </div>
	</div>
        

	<div class="row-fluid">
          <div class="span9">
            
        <div class="bodywrapper">
          <div class="body" id="spc-section-body" role="main">
            
  <div class="section" id="creating-an-interactive-hyetograph-with-chaco-and-traits">
<span id="tutorial-hyetograph"></span><h1>Creating an interactive Hyetograph with Chaco and Traits<a class="headerlink" href="#creating-an-interactive-hyetograph-with-chaco-and-traits" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>The perfect rainstorm (not to be confused with The Perfect Storm) has
a rainfall pattern that can be mathematically modelled.  The rain
starts light, progressively gets heavier until halfway though the
storm, gets lighter again, and eventually stops.  Plots of the
rainfall intensity in relation to time are called hyetographs.</p>
<p>This tutorial builds a small application that takes a tiny database of
coefficients, and along with user selected values, displays
hyetographs.  The user provides the duration of the storm, the year of
the storm, and one of four counties in Texas.  Then using a slider
specifying the Curve Number (determined based on the permeability of
the soil) a plot shows the intensity vs. time hyetograph plots.</p>
</div>
<div class="section" id="importing-the-necessary-functions">
<h2>Importing the necessary functions<a class="headerlink" href="#importing-the-necessary-functions" title="Permalink to this headline">¶</a></h2>
<p>In this example we will be using numpy, traits, traitsui, and chaco.
The following code snippet imports all the names that will be used for our
application, and defines our tiny database of coefficients.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">chaco.api</span> <span class="kn">import</span> <span class="n">ArrayPlotData</span><span class="p">,</span> <span class="n">Plot</span>
<span class="kn">from</span> <span class="nn">enable.api</span> <span class="kn">import</span> <span class="n">ComponentEditor</span>
<span class="kn">from</span> <span class="nn">traits.api</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">HasTraits</span><span class="p">,</span>
    <span class="n">Instance</span><span class="p">,</span>
    <span class="n">Int</span><span class="p">,</span>
    <span class="n">Range</span><span class="p">,</span>
    <span class="n">Array</span><span class="p">,</span>
    <span class="n">Enum</span><span class="p">,</span>
    <span class="n">observe</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">traitsui.api</span> <span class="kn">import</span> <span class="n">Item</span><span class="p">,</span> <span class="n">View</span>

<span class="n">COUNTIES</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Brazos&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Dallas&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;El Paso&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;Harris&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">}</span>
<span class="n">YEARS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="mi">65</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="o">.</span><span class="mi">806</span><span class="p">,</span> <span class="mi">54</span><span class="p">,</span> <span class="mf">8.3</span><span class="p">,</span> <span class="o">.</span><span class="mi">791</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mf">9.5</span><span class="p">,</span> <span class="o">.</span><span class="mi">797</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mf">7.9</span><span class="p">,</span> <span class="o">.</span><span class="mi">800</span><span class="p">],</span>
    <span class="mi">10</span><span class="p">:</span> <span class="p">[</span><span class="mi">80</span><span class="p">,</span> <span class="mf">8.5</span><span class="p">,</span> <span class="o">.</span><span class="mi">763</span><span class="p">,</span> <span class="mi">78</span><span class="p">,</span> <span class="mf">8.7</span><span class="p">,</span> <span class="o">.</span><span class="mi">777</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mf">12.</span><span class="p">,</span> <span class="o">.</span><span class="mi">795</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mf">7.7</span><span class="p">,</span> <span class="o">.</span><span class="mi">753</span><span class="p">],</span>
    <span class="mi">25</span><span class="p">:</span> <span class="p">[</span><span class="mi">89</span><span class="p">,</span> <span class="mf">8.5</span><span class="p">,</span> <span class="o">.</span><span class="mi">754</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mf">8.7</span><span class="p">,</span> <span class="o">.</span><span class="mi">774</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mf">12.</span><span class="p">,</span> <span class="o">.</span><span class="mi">843</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mf">7.7</span><span class="p">,</span> <span class="o">.</span><span class="mi">724</span><span class="p">],</span>
    <span class="mi">100</span><span class="p">:</span> <span class="p">[</span><span class="mi">96</span><span class="p">,</span> <span class="mf">8.</span><span class="p">,</span> <span class="o">.</span><span class="mi">730</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> <span class="mf">8.3</span><span class="p">,</span> <span class="o">.</span><span class="mi">762</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mf">9.5</span><span class="p">,</span> <span class="o">.</span><span class="mi">825</span><span class="p">,</span> <span class="mi">91</span><span class="p">,</span> <span class="mf">7.9</span><span class="p">,</span> <span class="o">.</span><span class="mi">706</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="trait-definitions">
<h2>Trait Definitions<a class="headerlink" href="#trait-definitions" title="Permalink to this headline">¶</a></h2>
<p>This application only requires one class that will contain the Traits
and mathematical calculations together.  Classes that contain Traits
must inherit from the <code class="xref py py-class docutils literal notranslate"><span class="pre">HasTraits</span></code> class or one of its subclasses.
Python’s multiple inheritance allows for mixing HasTraits objects with other
class hierarchies if needed.</p>
<p>Within this class we define all the variables using Traits types
which will later be used in the UI.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Hyetograph</span><span class="p">(</span><span class="n">HasTraits</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Creates a simple hyetograph demo. &quot;&quot;&quot;</span>

    <span class="n">timeline</span> <span class="o">=</span> <span class="n">Array</span><span class="p">()</span>

    <span class="n">intensity</span> <span class="o">=</span> <span class="n">Array</span><span class="p">()</span>

    <span class="n">nrcs</span> <span class="o">=</span> <span class="n">Array</span><span class="p">()</span>

    <span class="n">duration</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;In Hours&#39;</span><span class="p">)</span>

    <span class="n">year_storm</span> <span class="o">=</span> <span class="n">Enum</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

    <span class="n">county</span> <span class="o">=</span> <span class="n">Enum</span><span class="p">(</span><span class="s1">&#39;Brazos&#39;</span><span class="p">,</span> <span class="s1">&#39;Dallas&#39;</span><span class="p">,</span> <span class="s1">&#39;El Paso&#39;</span><span class="p">,</span> <span class="s1">&#39;Harris&#39;</span><span class="p">)</span>

    <span class="n">curve_number</span> <span class="o">=</span> <span class="n">Range</span><span class="p">(</span><span class="mi">70</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

    <span class="n">plot_type</span> <span class="o">=</span> <span class="n">Enum</span><span class="p">(</span><span class="s1">&#39;line&#39;</span><span class="p">,</span> <span class="s1">&#39;scatter&#39;</span><span class="p">)</span>

    <span class="n">intensity_plot</span> <span class="o">=</span> <span class="n">Instance</span><span class="p">(</span><span class="n">Plot</span><span class="p">)</span>

    <span class="n">nrcs_plot</span> <span class="o">=</span> <span class="n">Instance</span><span class="p">(</span><span class="n">Plot</span><span class="p">)</span>

    <span class="o">...</span>
</pre></div>
</div>
<p>The above code snippet shows a number of Traits features,</p>
<ol class="arabic simple">
<li><p>Traits are explicitly typed.</p></li>
<li><p>The naming convention with traits is that types are capitalized.</p></li>
<li><p>An Array is an array, an Int is an integer, an Enum is a single
value from a list of options, and a Range is a value between
two numbers.</p></li>
<li><p>All traits get a default value, such as whats done in the
Arrays, or they can be assigned an initial value as is done in
the duration trait.</p></li>
<li><p>Descriptions can be added to traits, such as is done in
duration.  This description is not visible except when viewing
the trait in a TraitsUI view, and then the description is seen
when the mouse hovers over the variable.</p></li>
<li><p>Traits are always contained within the class definition, and
each instance of the class will have a unique copy of the traits.</p></li>
</ol>
<p>The <a class="reference external" href="http://docs.enthought.com/traits/traits_api_reference/trait_types.html">Traits API Reference</a>
contains more information about the standard Trait types; specifically, see the
<code class="xref py py-mod docutils literal notranslate"><span class="pre">trait_types</span></code> module.</p>
</div>
<div class="section" id="setting-up-the-user-interface-ui">
<h2>Setting up the User Interface (UI)<a class="headerlink" href="#setting-up-the-user-interface-ui" title="Permalink to this headline">¶</a></h2>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">HasTraits</span></code> classes will automatically generate a view that contains an
editable entry for each trait within the class.  But a user-defined
view usually looks better, so we’ll use View and Items to change the
default class view.  Changing the default UI is done by creating a
trait on the class that is of the View type.  Multiple View traits can
be defined and used, with the one named <code class="docutils literal notranslate"><span class="pre">traits_view</span></code> being used as
the default.</p>
<p>Continuing with our application, here is the View definition.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Hyetograph</span><span class="p">(</span><span class="n">HasTraits</span><span class="p">):</span>

    <span class="o">...</span>

    <span class="n">traits_view</span> <span class="o">=</span> <span class="n">View</span><span class="p">(</span>
        <span class="n">Item</span><span class="p">(</span><span class="s1">&#39;plot_type&#39;</span><span class="p">),</span>
        <span class="n">Item</span><span class="p">(</span><span class="s2">&quot;intensity_plot&quot;</span><span class="p">,</span> <span class="n">editor</span><span class="o">=</span><span class="n">ComponentEditor</span><span class="p">()),</span>
        <span class="n">Item</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;duration&#39;</span><span class="p">),</span>
        <span class="n">Item</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;year_storm&#39;</span><span class="p">),</span>
        <span class="n">Item</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;county&#39;</span><span class="p">),</span>
        <span class="n">Item</span><span class="p">(</span><span class="s2">&quot;nrcs_plot&quot;</span><span class="p">,</span> <span class="n">editor</span><span class="o">=</span><span class="n">ComponentEditor</span><span class="p">()),</span>
        <span class="n">Item</span><span class="p">(</span><span class="s1">&#39;curve_number&#39;</span><span class="p">),</span>
        <span class="n">resizable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
        <span class="n">height</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>Views generally contain Item objects and named parameters.  Views can
also contain Groups of Items as well as many other types of layout
features not covered here.  By default, Item objects take a string of
the trait to edit.  For example, the <code class="docutils literal notranslate"><span class="pre">Item(name='county')</span></code> will
create a pull-down menu in the UI showing the four valid counties that
the user can select from.</p>
<p>There are three important observations to be seen in the above view
definition. First, there are two Chaco plots embedded in the
view.  This is done by explicitly specifying the Item’s editor to be a
<code class="xref py py-class docutils literal notranslate"><span class="pre">ComponentEditor</span></code>. The top plot is the intensity versus time and the
bottom is nrcs versus time. Second, default window will be sized at 800 by 800
pixels, but the option <code class="docutils literal notranslate"><span class="pre">resizable</span> <span class="pre">=</span> <span class="pre">True</span></code> will allow the user to
change the size of the window.  And third, the traits are split up so
3 of them are displayed below the first plot and only 1 is displayed
below the second.  Here is a snapshot of what our application will
display.  The plots are empty because we have yet to populate the data
traits or intialize the plot traits.</p>
<img alt="../_images/tutorial_hyetograph_nodata.png" src="../_images/tutorial_hyetograph_nodata.png" />
</div>
<div class="section" id="performing-the-hyetograph-calculations">
<h2>Performing the Hyetograph Calculations<a class="headerlink" href="#performing-the-hyetograph-calculations" title="Permalink to this headline">¶</a></h2>
<p>The UI for the application is complete, however there is no data.
Changing the traits within the GUI by moving the sliders and typing in
numbers does nothing because they’re hooked up to nothing and there
are no listeners on the trait event notifications.  First, we need to actually
set up the plots by defining methods to provide their defaults.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_intensity_plot_default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">intensity_plot</span> <span class="o">=</span> <span class="n">Plot</span><span class="p">(</span><span class="n">ArrayPlotData</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeline</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">intensity</span><span class="p">))</span>
    <span class="n">intensity_plot</span><span class="o">.</span><span class="n">x_axis</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Time (hr)&quot;</span>
    <span class="n">intensity_plot</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Intensity (in/hr)&quot;</span>
    <span class="n">intensity_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">),</span> <span class="nb">type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_type</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_type</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">intensity_plot</span>

<span class="k">def</span> <span class="nf">_nrcs_plot_default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">nrcs_plot</span> <span class="o">=</span> <span class="n">Plot</span><span class="p">(</span><span class="n">ArrayPlotData</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeline</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nrcs</span><span class="p">))</span>
    <span class="n">nrcs_plot</span><span class="o">.</span><span class="n">x_axis</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Time&quot;</span>
    <span class="n">nrcs_plot</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Intensity&quot;</span>
    <span class="n">nrcs_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">),</span> <span class="nb">type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_type</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_type</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">nrcs_plot</span>
</pre></div>
</div>
<p>Here we have created an <code class="xref py py-class docutils literal notranslate"><span class="pre">ArrayPlotData</span></code> instance to hold the data to be
plotted and we use that to create a <code class="xref py py-class docutils literal notranslate"><span class="pre">Plot</span></code> instance. We configure some
properties of the plot, and finally call the <code class="xref py py-meth docutils literal notranslate"><span class="pre">plot()</span></code> method to create the
appropriate renderer for the plot. However, at this point we still have not
actually specified any values for the data. So, we’ll add some hyetograph
calculations that modify the <code class="xref py py-attr docutils literal notranslate"><span class="pre">intensity</span></code> and <code class="xref py py-attr docutils literal notranslate"><span class="pre">nrcs</span></code> Array traits.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calculate_intensity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; The Hyetograph calculations. &quot;&quot;&quot;</span>
    <span class="c1"># Assigning A, B, and C values based on year, storm, and county</span>
    <span class="n">year</span> <span class="o">=</span> <span class="n">YEARS</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">year_storm</span><span class="p">]</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">COUNTIES</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">county</span><span class="p">]</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">year</span><span class="p">[</span><span class="n">value</span><span class="p">],</span> <span class="n">year</span><span class="p">[</span><span class="n">value</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">year</span><span class="p">[</span><span class="n">value</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">timeline</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span>
    <span class="n">intensity</span> <span class="o">=</span> <span class="n">a</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeline</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span><span class="o">**</span><span class="n">c</span>
    <span class="n">cumulative_depth</span> <span class="o">=</span> <span class="n">intensity</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeline</span>

    <span class="n">temp</span> <span class="o">=</span> <span class="n">cumulative_depth</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cumulative_depth</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">temp</span><span class="p">)</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">i</span>
    <span class="n">result</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">cumulative_depth</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># Alternating block method implementation.</span>
    <span class="n">result</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
    <span class="n">switch</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">o</span><span class="p">,</span> <span class="n">e</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">switch</span><span class="p">:</span>
            <span class="n">o</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">e</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">switch</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">switch</span>
    <span class="n">e</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">o</span> <span class="o">+</span> <span class="n">e</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">intensity</span> <span class="o">=</span> <span class="n">result</span>

<span class="k">def</span> <span class="nf">calculate_runoff</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; NRCS method to get run-off based on permeability of ground. &quot;&quot;&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1000</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">curve_number</span><span class="p">)</span> <span class="o">-</span> <span class="mi">10</span>
    <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intensity</span> <span class="o">-</span> <span class="p">(</span><span class="o">.</span><span class="mi">2</span> <span class="o">*</span> <span class="n">s</span><span class="p">)</span>
    <span class="n">vr</span> <span class="o">=</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">intensity</span> <span class="o">+</span> <span class="p">(</span><span class="o">.</span><span class="mi">8</span> <span class="o">*</span> <span class="n">s</span><span class="p">))</span>
    <span class="c1"># There&#39;s no such thing as negative run-off.</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">vr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nrcs</span> <span class="o">=</span> <span class="n">vr</span>
</pre></div>
</div>
<p>In the calculation functions, the traits are treated just like normal
attributes.  Behind the scenes, Traits will automatically cast
compatible types such as ints to Floats, but will raise an exception
if, for example, the user tries to pass a string to a Dict trait.</p>
</div>
<div class="section" id="recalculating-when-event-notification-occurs">
<h2>Recalculating when event notification occurs<a class="headerlink" href="#recalculating-when-event-notification-occurs" title="Permalink to this headline">¶</a></h2>
<p>Calling the calculation functions will update the data, but nothing is
going to change in the GUI.  The next step is to link the data to the
GUI using a Traits static handler.  Static handlers are declared
either with a decorator or through a function name that follows a
specific convention.  Alternatively, a dynamic handler is set up by
calling a function at runtime, providing for on-the-fly event
processing.  Below is a function that calls the two calculation
functions.  The interesting line is the decorator,
<code class="docutils literal notranslate"><span class="pre">&#64;observe</span></code> that tells Traits to call the function whenever
any of the values within the list of traits change.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@observe</span><span class="p">(</span><span class="s1">&#39;duration, year_storm, county, curve_number&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_perform_calculations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">calculate_intensity</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">calculate_runoff</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">intensity_plot</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">intensity</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nrcs_plot</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrcs</span><span class="p">)</span>
</pre></div>
</div>
<p>So now when the application is run, when any of the four listed traits change,
the calculation functions are automatically called and the data changes. Then
the 2 plots will be updated to use this new data. These traits will
automatically change when the user adjusts the widgets in the UI.  So when the
user changes the <code class="xref py py-attr docutils literal notranslate"><span class="pre">duration</span></code> in the UI from 12 hours to 24 hours this will
automatically effect both of the plots since the listeners force a
recalculation of both of the functions.</p>
<p>Furthermore, we also want the user to be able to select a <code class="xref py py-attr docutils literal notranslate"><span class="pre">plot_type</span></code>
and have the plots update accordingly.  To do so, we need to define a seperate
method to make this adjustment that listens to the <code class="xref py py-attr docutils literal notranslate"><span class="pre">plot_type</span></code> trait.
The code for this is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@observe</span><span class="p">(</span><span class="s2">&quot;plot_type&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_update_polt_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
    <span class="n">old_plot_type</span><span class="p">,</span> <span class="n">new_plot_type</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">old</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">new</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">intensity_plot</span><span class="o">.</span><span class="n">delplot</span><span class="p">(</span><span class="n">old_plot_type</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nrcs_plot</span><span class="o">.</span><span class="n">delplot</span><span class="p">(</span><span class="n">old_plot_type</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">intensity_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">),</span> <span class="nb">type</span><span class="o">=</span><span class="n">new_plot_type</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">new_plot_type</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nrcs_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">),</span> <span class="nb">type</span><span class="o">=</span><span class="n">new_plot_type</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">new_plot_type</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">intensity_plot</span><span class="o">.</span><span class="n">invalidate_and_redraw</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nrcs_plot</span><span class="o">.</span><span class="n">invalidate_and_redraw</span><span class="p">()</span>
</pre></div>
</div>
<p>Previously when creating plot renderers for our plots, we assigned their names
to simply match the <code class="xref py py-attr docutils literal notranslate"><span class="pre">plot_type</span></code> trait.  This way we can easily
delete the old plot and then create a new on of the correct type. Finally, we
call <code class="xref py py-meth docutils literal notranslate"><span class="pre">invalidate_and_redraw()</span></code> on the plots to ensur the UI gets refreshed.</p>
</div>
<div class="section" id="showing-the-display">
<h2>Showing the Display<a class="headerlink" href="#showing-the-display" title="Permalink to this headline">¶</a></h2>
<p>In order to start the GUI application an instance of the class must be
instantiated, and then a <code class="xref py py-meth docutils literal notranslate"><span class="pre">configure_traits()</span></code> call is done.  However we
must first call the data calculation functions from within the class
to initialize the data arrays.  Here’s the last piece of the program.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_perform_calculations</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">configure_traits</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">hyetograph</span> <span class="o">=</span> <span class="n">Hyetograph</span><span class="p">()</span>
    <span class="n">hyetograph</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<p><code class="xref py py-meth docutils literal notranslate"><span class="pre">start()</span></code> performs the calculations needed for the Arrays used to plot,
and then triggers the UI.  The application is complete, and if you now
run the program, you should get a running application that resembles
the following image,</p>
<img alt="../_images/tutorial_hyetograph_final.png" src="../_images/tutorial_hyetograph_final.png" />
<p>Congratulations!</p>
</div>
<div class="section" id="source-code">
<h2>Source Code<a class="headerlink" href="#source-code" title="Permalink to this headline">¶</a></h2>
<p>The final version of the program,
<a class="reference external" href="https://github.com/enthought/chaco/blob/master/chaco/examples/demo/hyetograph.py">hyetograph.py</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">chaco.api</span> <span class="kn">import</span> <span class="n">ArrayPlotData</span><span class="p">,</span> <span class="n">Plot</span>
<span class="kn">from</span> <span class="nn">enable.api</span> <span class="kn">import</span> <span class="n">ComponentEditor</span>
<span class="kn">from</span> <span class="nn">traits.api</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Bool</span><span class="p">,</span>
    <span class="n">HasTraits</span><span class="p">,</span>
    <span class="n">Instance</span><span class="p">,</span>
    <span class="n">Int</span><span class="p">,</span>
    <span class="n">Range</span><span class="p">,</span>
    <span class="n">Array</span><span class="p">,</span>
    <span class="n">Enum</span><span class="p">,</span>
    <span class="n">observe</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">traitsui.api</span> <span class="kn">import</span> <span class="n">Item</span><span class="p">,</span> <span class="n">View</span>

<span class="n">COUNTIES</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Brazos&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Dallas&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;El Paso&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;Harris&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">}</span>
<span class="n">YEARS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="mi">65</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="o">.</span><span class="mi">806</span><span class="p">,</span> <span class="mi">54</span><span class="p">,</span> <span class="mf">8.3</span><span class="p">,</span> <span class="o">.</span><span class="mi">791</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mf">9.5</span><span class="p">,</span> <span class="o">.</span><span class="mi">797</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mf">7.9</span><span class="p">,</span> <span class="o">.</span><span class="mi">800</span><span class="p">],</span>
    <span class="mi">10</span><span class="p">:</span> <span class="p">[</span><span class="mi">80</span><span class="p">,</span> <span class="mf">8.5</span><span class="p">,</span> <span class="o">.</span><span class="mi">763</span><span class="p">,</span> <span class="mi">78</span><span class="p">,</span> <span class="mf">8.7</span><span class="p">,</span> <span class="o">.</span><span class="mi">777</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mf">12.</span><span class="p">,</span> <span class="o">.</span><span class="mi">795</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mf">7.7</span><span class="p">,</span> <span class="o">.</span><span class="mi">753</span><span class="p">],</span>
    <span class="mi">25</span><span class="p">:</span> <span class="p">[</span><span class="mi">89</span><span class="p">,</span> <span class="mf">8.5</span><span class="p">,</span> <span class="o">.</span><span class="mi">754</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mf">8.7</span><span class="p">,</span> <span class="o">.</span><span class="mi">774</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mf">12.</span><span class="p">,</span> <span class="o">.</span><span class="mi">843</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mf">7.7</span><span class="p">,</span> <span class="o">.</span><span class="mi">724</span><span class="p">],</span>
    <span class="mi">100</span><span class="p">:</span> <span class="p">[</span><span class="mi">96</span><span class="p">,</span> <span class="mf">8.</span><span class="p">,</span> <span class="o">.</span><span class="mi">730</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> <span class="mf">8.3</span><span class="p">,</span> <span class="o">.</span><span class="mi">762</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mf">9.5</span><span class="p">,</span> <span class="o">.</span><span class="mi">825</span><span class="p">,</span> <span class="mi">91</span><span class="p">,</span> <span class="mf">7.9</span><span class="p">,</span> <span class="o">.</span><span class="mi">706</span><span class="p">]</span>
<span class="p">}</span>


<span class="k">class</span> <span class="nc">Hyetograph</span><span class="p">(</span><span class="n">HasTraits</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Creates a simple hyetograph demo. &quot;&quot;&quot;</span>

    <span class="n">timeline</span> <span class="o">=</span> <span class="n">Array</span><span class="p">()</span>

    <span class="n">intensity</span> <span class="o">=</span> <span class="n">Array</span><span class="p">()</span>

    <span class="n">nrcs</span> <span class="o">=</span> <span class="n">Array</span><span class="p">()</span>

    <span class="n">duration</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;In Hours&#39;</span><span class="p">)</span>

    <span class="n">year_storm</span> <span class="o">=</span> <span class="n">Enum</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

    <span class="n">county</span> <span class="o">=</span> <span class="n">Enum</span><span class="p">(</span><span class="s1">&#39;Brazos&#39;</span><span class="p">,</span> <span class="s1">&#39;Dallas&#39;</span><span class="p">,</span> <span class="s1">&#39;El Paso&#39;</span><span class="p">,</span> <span class="s1">&#39;Harris&#39;</span><span class="p">)</span>

    <span class="n">curve_number</span> <span class="o">=</span> <span class="n">Range</span><span class="p">(</span><span class="mi">70</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

    <span class="n">plot_type</span> <span class="o">=</span> <span class="n">Enum</span><span class="p">(</span><span class="s1">&#39;line&#39;</span><span class="p">,</span> <span class="s1">&#39;scatter&#39;</span><span class="p">)</span>

    <span class="n">intensity_plot</span> <span class="o">=</span> <span class="n">Instance</span><span class="p">(</span><span class="n">Plot</span><span class="p">)</span>

    <span class="n">nrcs_plot</span> <span class="o">=</span> <span class="n">Instance</span><span class="p">(</span><span class="n">Plot</span><span class="p">)</span>

    <span class="n">initialized</span> <span class="o">=</span> <span class="n">Bool</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialized</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_intensity_plot_default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">intensity_plot</span> <span class="o">=</span> <span class="n">Plot</span><span class="p">(</span><span class="n">ArrayPlotData</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeline</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">intensity</span><span class="p">))</span>
        <span class="n">intensity_plot</span><span class="o">.</span><span class="n">x_axis</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Time (hr)&quot;</span>
        <span class="n">intensity_plot</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Intensity (in/hr)&quot;</span>
        <span class="n">intensity_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">),</span> <span class="nb">type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_type</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_type</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">intensity_plot</span>

    <span class="k">def</span> <span class="nf">_nrcs_plot_default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">nrcs_plot</span> <span class="o">=</span> <span class="n">Plot</span><span class="p">(</span><span class="n">ArrayPlotData</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeline</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nrcs</span><span class="p">))</span>
        <span class="n">nrcs_plot</span><span class="o">.</span><span class="n">x_axis</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Time&quot;</span>
        <span class="n">nrcs_plot</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Intensity&quot;</span>
        <span class="n">nrcs_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">),</span> <span class="nb">type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_type</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_type</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">nrcs_plot</span>

    <span class="k">def</span> <span class="nf">calculate_intensity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The Hyetograph calculations. &quot;&quot;&quot;</span>
        <span class="c1"># Assigning A, B, and C values based on year, storm, and county</span>
        <span class="n">year</span> <span class="o">=</span> <span class="n">YEARS</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">year_storm</span><span class="p">]</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">COUNTIES</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">county</span><span class="p">]</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">year</span><span class="p">[</span><span class="n">value</span><span class="p">],</span> <span class="n">year</span><span class="p">[</span><span class="n">value</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">year</span><span class="p">[</span><span class="n">value</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">timeline</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span>
        <span class="n">intensity</span> <span class="o">=</span> <span class="n">a</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeline</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span><span class="o">**</span><span class="n">c</span>
        <span class="n">cumulative_depth</span> <span class="o">=</span> <span class="n">intensity</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeline</span>

        <span class="n">temp</span> <span class="o">=</span> <span class="n">cumulative_depth</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cumulative_depth</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">temp</span><span class="p">)</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">i</span>
        <span class="n">result</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">cumulative_depth</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="c1"># Alternating block method implementation.</span>
        <span class="n">result</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
        <span class="n">switch</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">o</span><span class="p">,</span> <span class="n">e</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">switch</span><span class="p">:</span>
                <span class="n">o</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">e</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">switch</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">switch</span>
        <span class="n">e</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">o</span> <span class="o">+</span> <span class="n">e</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intensity</span> <span class="o">=</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">calculate_runoff</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; NRCS method to get run-off based on permeability of ground. &quot;&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1000</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">curve_number</span><span class="p">)</span> <span class="o">-</span> <span class="mi">10</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intensity</span> <span class="o">-</span> <span class="p">(</span><span class="o">.</span><span class="mi">2</span> <span class="o">*</span> <span class="n">s</span><span class="p">)</span>
        <span class="n">vr</span> <span class="o">=</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">intensity</span> <span class="o">+</span> <span class="p">(</span><span class="o">.</span><span class="mi">8</span> <span class="o">*</span> <span class="n">s</span><span class="p">))</span>
        <span class="c1"># There&#39;s no such thing as negative run-off.</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">vr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nrcs</span> <span class="o">=</span> <span class="n">vr</span>

    <span class="nd">@observe</span><span class="p">(</span><span class="s1">&#39;duration, year_storm, county, curve_number, initialized&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_perform_calculations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculate_intensity</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculate_runoff</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intensity_plot</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">intensity</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nrcs_plot</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrcs</span><span class="p">)</span>

    <span class="nd">@observe</span><span class="p">(</span><span class="s2">&quot;plot_type&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_update_polt_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="n">old_plot_type</span><span class="p">,</span> <span class="n">new_plot_type</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">old</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">new</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">intensity_plot</span><span class="o">.</span><span class="n">delplot</span><span class="p">(</span><span class="n">old_plot_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nrcs_plot</span><span class="o">.</span><span class="n">delplot</span><span class="p">(</span><span class="n">old_plot_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intensity_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">),</span> <span class="nb">type</span><span class="o">=</span><span class="n">new_plot_type</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">new_plot_type</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nrcs_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">),</span> <span class="nb">type</span><span class="o">=</span><span class="n">new_plot_type</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">new_plot_type</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intensity_plot</span><span class="o">.</span><span class="n">invalidate_and_redraw</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nrcs_plot</span><span class="o">.</span><span class="n">invalidate_and_redraw</span><span class="p">()</span>

    <span class="n">traits_view</span> <span class="o">=</span> <span class="n">View</span><span class="p">(</span>
        <span class="n">Item</span><span class="p">(</span><span class="s1">&#39;plot_type&#39;</span><span class="p">),</span>
        <span class="n">Item</span><span class="p">(</span><span class="s2">&quot;intensity_plot&quot;</span><span class="p">,</span> <span class="n">editor</span><span class="o">=</span><span class="n">ComponentEditor</span><span class="p">()),</span>
        <span class="n">Item</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;duration&#39;</span><span class="p">),</span>
        <span class="n">Item</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;year_storm&#39;</span><span class="p">),</span>
        <span class="n">Item</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;county&#39;</span><span class="p">),</span>
        <span class="n">Item</span><span class="p">(</span><span class="s2">&quot;nrcs_plot&quot;</span><span class="p">,</span> <span class="n">editor</span><span class="o">=</span><span class="n">ComponentEditor</span><span class="p">()),</span>
        <span class="n">Item</span><span class="p">(</span><span class="s1">&#39;curve_number&#39;</span><span class="p">),</span>
        <span class="n">resizable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
        <span class="n">height</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="p">)</span>


<span class="n">popup</span> <span class="o">=</span> <span class="n">Hyetograph</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">popup</span><span class="o">.</span><span class="n">configure_traits</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
          </div>
      <div class="spc-rightsidebar span3">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/img/e-logo.png" alt="Logo">
            </a></p>
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Creating an interactive Hyetograph with Chaco and Traits</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#importing-the-necessary-functions">Importing the necessary functions</a></li>
<li><a class="reference internal" href="#trait-definitions">Trait Definitions</a></li>
<li><a class="reference internal" href="#setting-up-the-user-interface-ui">Setting up the User Interface (UI)</a></li>
<li><a class="reference internal" href="#performing-the-hyetograph-calculations">Performing the Hyetograph Calculations</a></li>
<li><a class="reference internal" href="#recalculating-when-event-notification-occurs">Recalculating when event notification occurs</a></li>
<li><a class="reference internal" href="#showing-the-display">Showing the Display</a></li>
<li><a class="reference internal" href="#source-code">Source Code</a></li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <div>
    <a href="../_sources/user_manual/tutorial_hyetograph.rst.txt"
       rel="nofollow">Show Source</a>
  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
        </div>
      </div>
    </div>

    <div class="container container-navbar-bottom">
      <div class="spc-navbar">
        
      </div>
    </div>
    <div class="container">
    <div class="footer">
    <div class="row-fluid">
    <ul class="inline pull-left">
      <li>
        &copy; Copyright 2008-2019, Enthought, Inc.
      </li>
      <li>
      Last updated on Jun 15, 2021.
      </li>
      <li>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 2.3.1.
      </li>
    </ul>
    </div>
    </div>
    </div>
  </body>
</html>